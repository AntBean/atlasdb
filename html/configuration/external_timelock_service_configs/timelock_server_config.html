

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Timelock Server Configuration &mdash; OSS AtlasDB develop documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/release-notes.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="OSS AtlasDB develop documentation" href="../../index.html"/>
        <link rel="up" title="External Timelock Service Configurations" href="index.html"/>
        <link rel="next" title="Timelock Client Configuration" href="timelock_client_config.html"/>
        <link rel="prev" title="External Timelock Service Configurations" href="index.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> OSS AtlasDB
          

          
          </a>

          
            
            
              <div class="version">
                develop
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../schemas/index.html">Schemas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../transactions/index.html">Transactions</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Configuration</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../key_value_service_configs/index.html">Key Value Service Configurations</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">External Timelock Service Configurations</a><ul class="current">
<li class="toctree-l3 current"><a class="current reference internal" href="#">Timelock Server Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="timelock_client_config.html">Timelock Client Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../cassandra_config.html">Cassandra Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../multinode_cassandra.html">Multinode Cassandra HA Guarantees</a></li>
<li class="toctree-l2"><a class="reference internal" href="../enabling_cassandra_tracing.html">Enabling Cassandra Tracing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../leader_config.html">Leader Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logging.html">Logging Configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../cluster_management/index.html">Cluster Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../services/index.html">Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../performance/index.html">Performance Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../miscellaneous/index.html">Miscellaneous</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../troubleshooting/index.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../release_notes/index.html">Releases</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">OSS AtlasDB</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Configuration</a> &raquo;</li>
        
          <li><a href="index.html">External Timelock Service Configurations</a> &raquo;</li>
        
      <li>Timelock Server Configuration</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/palantir/atlasdb/blob/develop/docs/source/configuration/external_timelock_service_configs/timelock_server_config.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="timelock-server-configuration">
<span id="id1"></span><h1>Timelock Server Configuration<a class="headerlink" href="#timelock-server-configuration" title="Permalink to this headline">¶</a></h1>
<p>The Timelock Server configuration file is written in YAML and is located at <code class="docutils literal"><span class="pre">var/conf/timelock.yml</span></code>.
It has three main configuration blocks: <code class="docutils literal"><span class="pre">clients</span></code>, <code class="docutils literal"><span class="pre">cluster</span></code>, and <code class="docutils literal"><span class="pre">algorithm</span></code>. We will discuss how each of
these may be configured in turn, as well as additional configuration parameters.</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#clients" id="id2">Clients</a></li>
<li><a class="reference internal" href="#cluster" id="id3">Cluster</a></li>
<li><a class="reference internal" href="#algorithm" id="id4">Algorithm</a><ul>
<li><a class="reference internal" href="#paxos-configuration" id="id5">Paxos Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#further-configuration-parameters" id="id6">Further Configuration Parameters</a></li>
</ul>
</div>
<div class="section" id="clients">
<span id="timelock-server-clients"></span><h2><a class="toc-backref" href="#id2">Clients</a><a class="headerlink" href="#clients" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal"><span class="pre">clients</span></code> block is a list of strings which corresponds to client namespaces that the server will respond to.
At least one client must be configured for the Timelock Server to work. Querying an endpoint for a client that does not
exist will result in a 404. Note that client names must consist of only alphanumeric characters, dashes and
underscores (succinctly, <code class="docutils literal"><span class="pre">[a-zA-Z0-9_-]+</span></code>) and for backwards compatibility cannot be the reserved word <code class="docutils literal"><span class="pre">leader</span></code>.</p>
<blockquote>
<div><div class="code yaml highlight-default"><div class="highlight"><pre><span></span><span class="n">clients</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">tom</span>
  <span class="o">-</span> <span class="n">jerry</span>
</pre></div>
</div>
</div></blockquote>
<p>A single Timelock Server or cluster of Timelock Servers can support multiple AtlasDB clients. When querying a
Timelock Server, clients must supply a namespace for which they are requesting timestamps or locks in the form of a
path variable. There are no guarantees of relationships between timestamps requested from different namespaces.</p>
<blockquote>
<div><div class="code bash highlight-default"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">XPOST</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">8080</span><span class="o">/</span><span class="n">tom</span><span class="o">/</span><span class="n">timestamp</span><span class="o">/</span><span class="n">fresh</span><span class="o">-</span><span class="n">timestamp</span>
<span class="n">curl</span> <span class="o">-</span><span class="n">XPOST</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">8080</span><span class="o">/</span><span class="n">jerry</span><span class="o">/</span><span class="n">timestamp</span><span class="o">/</span><span class="n">fresh</span><span class="o">-</span><span class="n">timestamp</span> <span class="c1"># no guarantees of any relationship between the values</span>
</pre></div>
</div>
</div></blockquote>
<p>This is done for performance reasons: consider that if we maintained a global timestamp across all clients, then
requests from each of these clients would need to all be synchronized.</p>
</div>
<div class="section" id="cluster">
<h2><a class="toc-backref" href="#id3">Cluster</a><a class="headerlink" href="#cluster" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You will probably want to use an odd number of servers; using an even number of servers increases the overhead
of distributed consensus while not actually providing any additional fault tolerance as far as obtaining a quorum
is concerned. Using more servers leads to improved fault tolerance at the expense of additional overhead incurred
in leader election and consensus.</p>
</div>
<p>The <code class="docutils literal"><span class="pre">cluster</span></code> block is used to identify the servers which make up a Timelock Service cluster. An example is as
follows:</p>
<blockquote>
<div><div class="code yaml highlight-default"><div class="highlight"><pre><span></span><span class="n">cluster</span><span class="p">:</span>
  <span class="n">localServer</span><span class="p">:</span> <span class="n">palantir</span><span class="o">-</span><span class="mf">1.</span><span class="n">com</span><span class="p">:</span><span class="mi">8080</span>
  <span class="n">servers</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">palantir</span><span class="o">-</span><span class="mf">1.</span><span class="n">com</span><span class="p">:</span><span class="mi">8080</span>
    <span class="o">-</span> <span class="n">palantir</span><span class="o">-</span><span class="mf">2.</span><span class="n">com</span><span class="p">:</span><span class="mi">8080</span>
    <span class="o">-</span> <span class="n">palantir</span><span class="o">-</span><span class="mf">3.</span><span class="n">com</span><span class="p">:</span><span class="mi">8080</span>
</pre></div>
</div>
</div></blockquote>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>localServer</td>
<td>A string following the form <code class="docutils literal"><span class="pre">hostname:port</span></code> which matches the host on which this config exists.</td>
</tr>
<tr class="row-odd"><td>servers</td>
<td>A list of strings following the form <code class="docutils literal"><span class="pre">hostname:port</span></code> identifying the hosts in this Timelock
Service cluster. Note that this list must include the <code class="docutils literal"><span class="pre">localServer</span></code>.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="algorithm">
<h2><a class="toc-backref" href="#id4">Algorithm</a><a class="headerlink" href="#algorithm" title="Permalink to this headline">¶</a></h2>
<p>We have implemented the consensus algorithm required by the Timelock Server using the Paxos algorithm.
Currently, this is the only supported implementation, though there may be more in the future.
We identify an algorithm by its <code class="docutils literal"><span class="pre">type</span></code> field first; algorithms can have additional algorithmic-specific
customisable parameters as well.</p>
<div class="section" id="paxos-configuration">
<h3><a class="toc-backref" href="#id5">Paxos Configuration</a><a class="headerlink" href="#paxos-configuration" title="Permalink to this headline">¶</a></h3>
<p>The algorithm has several configurable parameters; all parameters (apart from <code class="docutils literal"><span class="pre">type</span></code>) are optional and have
default values.</p>
<blockquote>
<div><div class="code yaml highlight-default"><div class="highlight"><pre><span></span><span class="n">algorithm</span><span class="p">:</span>
  <span class="nb">type</span><span class="p">:</span> <span class="n">paxos</span>
  <span class="n">paxosDataDir</span><span class="p">:</span> <span class="n">var</span><span class="o">/</span><span class="n">log</span><span class="o">/</span><span class="n">paxos</span>
  <span class="n">sslConfiguration</span><span class="p">:</span>
    <span class="n">trustStorePath</span><span class="p">:</span> <span class="n">var</span><span class="o">/</span><span class="n">security</span><span class="o">/</span><span class="n">trustStore</span><span class="o">.</span><span class="n">jks</span>
  <span class="n">pingRateMs</span><span class="p">:</span> <span class="mi">5000</span>
  <span class="n">maximumWaitBeforeProposalMs</span><span class="p">:</span> <span class="mi">1000</span>
  <span class="n">leaderPingResponseWaitMs</span><span class="p">:</span> <span class="mi">5000</span>
</pre></div>
</div>
</div></blockquote>
<table border="1" class="colwidths-given docutils">
<colgroup>
<col width="11%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>type</td>
<td>The type of algorithm to use; currently only <code class="docutils literal"><span class="pre">paxos</span></code> is supported.</td>
</tr>
<tr class="row-odd"><td>paxosDataDir</td>
<td>A path corresponding to the location in which Paxos will store its logs (of accepted promises and learned
values) (default: <code class="docutils literal"><span class="pre">var/data/paxos</span></code>). The Timelock Server will fail to start if this directory does not
exist and cannot be created.</td>
</tr>
<tr class="row-even"><td>sslConfiguration</td>
<td>Security settings for communication between Timelock Servers, following the
<a class="reference external" href="https://github.com/palantir/http-remoting/blob/develop/ssl-config/src/main/java/com/palantir/remoting1/config/ssl/SslConfiguration.java">palantir/http-remoting</a>
library (default: no SSL).</td>
</tr>
<tr class="row-odd"><td>pingRateMs</td>
<td>The interval between followers pinging leaders to check if they are still alive, in ms (default: <code class="docutils literal"><span class="pre">5000</span></code>).
The server will fail to start if this is not positive.</td>
</tr>
<tr class="row-even"><td>maximumWaitBeforeProposalMs</td>
<td>The maximum wait before a follower proposes leadership if it believes the leader is down, or before
a leader attempts to propose a value again if it couldn&#8217;t obtain a quorum, in ms (default: <code class="docutils literal"><span class="pre">1000</span></code>).</td>
</tr>
<tr class="row-odd"><td>leaderPingWaitResponseMs</td>
<td>The length of time between a follower initiating a ping to a leader and, if it hasn&#8217;t received a response,
believing the leader is down, in ms (default: <code class="docutils literal"><span class="pre">5000</span></code>).</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="further-configuration-parameters">
<h2><a class="toc-backref" href="#id6">Further Configuration Parameters</a><a class="headerlink" href="#further-configuration-parameters" title="Permalink to this headline">¶</a></h2>
<p>The Timelock Server is implemented as a Dropwizard application, and may thus be suitably configured with a <code class="docutils literal"><span class="pre">server</span></code>
block following <a class="reference external" href="http://www.dropwizard.io/0.9.3/docs/manual/configuration.html">Dropwizard&#8217;s configuration</a>. This
may be useful if, for example, one needs to change the application and/or admin ports for the Timelock Server.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="timelock_client_config.html" class="btn btn-neutral float-right" title="Timelock Client Configuration" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="External Timelock Service Configurations" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Palantir Technologies.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'develop',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>